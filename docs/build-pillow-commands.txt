# Commands to Build Pillow Wheel (Based on Error #15 Fix)

## Prerequisites (Install First - CRITICAL!)

```bash
# Install all image format libraries (required for Pillow)
pkg install -y libjpeg-turbo libpng libtiff libwebp freetype libimagequant libraqm littlecms openjpeg zlib
```

## Minimal Installation (JPEG Only)

If you only need basic JPEG support:

```bash
pkg install -y libjpeg-turbo zlib
```

## Build Pillow Wheel

```bash
# Set parallelism limits
export NINJAFLAGS="-j2"
export MAKEFLAGS="-j2"
export MAX_JOBS=2

# Navigate to wheels directory
cd ~/wheels

# Download Pillow source
pip download pillow --dest . --no-cache-dir

# Build Pillow wheel
pip wheel pillow --no-deps --wheel-dir .

# Install from wheel
pip install --find-links . --no-index pillow*.whl

# Verify
pip show pillow
python3 -c "from PIL import Image; print('âœ… Pillow installed')"
```

## One-Liner (Complete Sequence)

```bash
pkg install -y libjpeg-turbo libpng libtiff libwebp freetype libimagequant libraqm littlecms openjpeg zlib && export NINJAFLAGS="-j2" && export MAKEFLAGS="-j2" && export MAX_JOBS=2 && cd ~/wheels && pip download pillow --dest . --no-cache-dir && pip wheel pillow --no-deps --wheel-dir . && pip install --find-links . --no-index pillow*.whl && pip show pillow
```

## Via ADB (From Host Machine)

```bash
adb shell "run-as com.termux sh -c 'export PREFIX=/data/data/com.termux/files/usr && export HOME=/data/data/com.termux/files/home && export PATH=\$PREFIX/bin:\$PATH && pkg install -y libjpeg-turbo libpng libtiff libwebp freetype libimagequant libraqm littlecms openjpeg zlib && export NINJAFLAGS=\"-j2\" && export MAKEFLAGS=\"-j2\" && export MAX_JOBS=2 && cd ~/wheels && pip download pillow --dest . --no-cache-dir && pip wheel pillow --no-deps --wheel-dir . && pip install --find-links . --no-index pillow*.whl'"
```

## Check Prerequisites

```bash
# Check if image libraries are installed
pkg list-installed | grep -E "jpeg|png|tiff|webp|freetype"

# Check library files exist
ls -la $PREFIX/lib/libjpeg* $PREFIX/lib/libpng* 2>/dev/null || echo "Libraries not found"
```

## Required Libraries Explained

- **libjpeg-turbo** - JPEG support (CRITICAL - main error)
- **libpng** - PNG support
- **libtiff** - TIFF support
- **libwebp** - WebP support
- **freetype** - Font rendering
- **libimagequant** - Color quantization
- **libraqm** - Text shaping
- **littlecms** - Color management
- **openjpeg** - JPEG 2000 support
- **zlib** - Compression

## Notes

- **libjpeg-turbo** is the most critical - install this first
- Other libraries enable additional image format support
- Pillow can build with minimal libraries, but more = more formats
- Build time: ~5-15 minutes
- Wheel size: ~2-5 MB

